#  2019-02-15-node.md

## js语法

```bash

  1.交互式运行环境--REPL
    如何进入REPL环境：在控制台直接输入node
	如何退出REPL环境：连续两次按CTRL+C    或者输入.exit
	## node.js命令需要在前面加点
	## .help 查看所有命令
  2.浏览器运行环境--Chrome
    打开开发者工具
  3.数据类型
   有两种：简单数据类型 undefined boolean number string null
          复杂数据类型 object
   (1)利用typeof区分数据类型
   		# null和object都返回了object，这是因为null实际上是一个空对象指针
   (2)利用Boolean()转化数据类型
       # 空字符串 0 null undefined NaN    都会转化为false
       # 其他值都会转化为true
  4.函数
    函数中默认带有一个arguments对象，这是个类数组对象，它纪录了传递给函数的参数信息，因为js中的函数调用时，参数的个数和定义的函数的个数不一致时，函数仍会正常执行
    # 利用js中的arguments类数组对象模拟函数重载，实际上就js并不支持函数重载，比如通过检测对象的length属性做出不同的反应来模拟重载
    # 因为arguments并不是真正的数组对象，只是与数组类似而已，所以它并没有slice这个方法，而Array.prototype.slice.call(arguments)可以理解成是让arguments转换成一个数组对象，让arguments具有slice()方法。要是直接写arguments.slice(1)会报错。
   5. 闭包
   js中的函数可以读取到全局变量，而函数外部读取不到函数内部定义的变量
   js的闭包也可以让函数读取到其他函数中的变量,请看下面的代码
```

```javascript
function a(){
    var str='node.js';
    return function() {
        var str2= str+"is powerful";
        return str2;
    }
}
a()();
// node.js is powerful
```

## Node.js中的包管理

### NPM 介绍

常用命令

```javascript
npm -v   npm version // 查看npm的安装版本
npm init // 生成package.json的文件，这个文件是整个项目的描述文件，这个文件记载了项目的包依赖关系，版本，作者等信息
npm init -y // 默认生成package.json
npm install // 安装命令包
npm install --save // 安装包
npm install -dev // 安装开发阶段的包
npm uninstall // 卸载包
```

### 模块加载原理与加载方式

node.js的模块可以分为原生模块和文件模块，通过require来引入模块，exports来导出模块

1 require导入模块

```bash
# 对于原生模块，只需要使用require进入即可，加载模块时可以省略.js的扩展名
```

2 exports导出模块

```bash
# 如果想与其他模块共享一些方法和属性，使用exports导出一个对象
导出：module.expots = 对象
引用： require（"模块名称"）
```

## Node.j核心模块

### http模块---创建http服务器，客户端

```javascript
1. node.js服务器端
    http.createServer()返回的事http模块封装的一个基于事件的http服务器
    httpServer的事件：
     	request 当客户端请求到来时，该事件被触发，提供req和res参数，表示请求和响应信息
     	connection 当TCP连接建立时，该事件被触发，提供一个socket参数，是.net.Socket的实例
     	close  当服务器关闭时触发（注意不是在用户断开连接时）
    http.IncomingMessage是http请求的信息
         data: 当请求体数据到来时触发，提供chunk参数，表示接受的数据
         end: 请求体数据传输完毕触发
         close： 用户请求结束触发
    http.ServerResponse是返回给客户端的信息
         res.writeHead(statusCode,【heasers】)
         res.write(data,[encoding])
         res.end(data,[encoding])
2. 客户端向http服务器发起请求
   http.request(option):option 是个json对象，主要字段有host,port ,method,path,headers该方法返回一个httpClientRequest实例
   利用http.get()方法可以实现同样的效果
   与服务端一样，http.request()和http.get()返回的是http.ClientRequest()实例
   http.ClientRequest()类主要的事件和方法有：
      response 接受响应时触发
      request.write(chunk,[encoding],[callback]) 发送请求数据触发
      res.end([data],[endcoding],[callback])  发送请求完毕触发
```

```javascript
// 注意： 执行node脚本时，会出现这样的报错
events.js:71
throw arguments[1]; // Unhandled 'error' event
^
Error: connect ECONNREFUSED
at errnoException (net.js:770:11)
at Object.afterConnect [as oncomplete] (net.js:761:19)
这主要由于上一次node.js server进程仍然还在运行没关闭掉，所以我们需要杀掉此进程，在mac上操作为：
ps aux | grep node

twer 7668 4.3 1.0 42060 10708 pts/1 Sl+ 20:36 0:00 node server 
twer 7749 0.0 0.0 4384 832 pts/8 S+ 20:37 0:00 grep --color=auto node

从输出可以看见进程PID7668在使用，所以我们必须杀掉这顽固分子，运行kill -9 7668，一键搞定，可以重新开启server了。
//查看进程：ps
//结束进程：kill +进程PID
//强制结束进程：kill -9+进程PID
// 查看端口占用情况 ：lsof -i tcp:端口号

```

### url模块--URL地址处理---分析解析url

​	在文件中通过require('url')引入就可以

​       该模块提供了3种方法：

​              url.parse(url)    解析一个url地址，返回URL对象

​              Url.format(urlObj).  接受一个url对象为参数，返回完整的url地址

​               Url.resolve(from,to) 接受一个base url对象和一个href url对象，像浏览器一样返回一个完整的地址

### queryString模块—查询字符串处理

在文件中引入require('querystring')即可

 该模块提的几种方法：

​              querystring.parse()    将查询字符串反序列化为一个对象，类似JSON.parse（）

​              querystring.stringify()  将一个对象序列化为一个字符串，类似JSON.stringify() 

## Node.js常用模块

### util模块---实用工具

这是一个工具模块

提供一下主要方法

   ```javascript
util.inspect()   // 返回一个对象反序列化形成的字符串,这个方法在调试时非常有用，因为在控制台可以输出样式和风格，有利于区分数据，只需要在这个方法后加一个json对象参数，将color设置为true
util.formet()  // 返回一个使用占位符格式化的字符串,如果参数<占位符，那么多余的占位符不会被替换
               //参数>占位符，剩余参数通过util.inspect()转换成字符串
              // 没有占位符，以空格分割各个参数并拼接成字符串
util.log()    // 在控制台输出，类似于console.log，但是这个方法提供时间戳
util.isArray()  util.isRegExp()  util.isDate()// 判断数据类型的方法
   ```

### path模块 ---路径处理


# 2019-02-14-http.md

## TCP/IP的分层管理

```bash
共4层：
应用层：决定向用户提供应用服务时通信的活动 eg: File Transfer Protocol, Domain Name System ,http协议
传输层： 对上层应用层，提供处于网络连接中的两台计算机之间数据传输服务 eg: TCP UDP
网络层(网络互连层)： 用来处理网络上流动的数据包
数据链路层：用来处理连接网络的硬件部分
```

## TCP/IP通信传输流

客户端的顺序： 应用层=》传输层=〉网络层=》数据链路层

服务端的顺序：数据链路层=〉网络层=》传输层=〉 应用层

```bash
发送端在层与层之间传输数据时，每经过一层时必定会被打上一个该层所属的首部信息。反之，接收端在层与层传输数据时，每进过一层时就会将对应的首部消去
这种将数据信息包装起来的做法叫做数据分装
```

## 与http关系密切的协议：IP，TCP和DNS

```bash
1 负责传输的IP协议
  位于网络层
  作用： 将各种数据包传送给对方
  两个重要条件： IP地址：指明节点被分配到的地址
  			   MAC地址： 网卡所属的固定地址
2 负责可靠性的TCP协议
  位于传输层
  作用： 提供可靠的字节流服务（为了方便传输，将大块数据分割成以报文段为单位的数据包进行管理）
  三次握手
3 负责域名解析的DNS服务
  位于应用层
  作用： 提供域名到IP地址之间的解析服务
```

## 统一资源标识符（URI）

```bash
URI用字符串标识某一互联网资源，而URL表示资源的地点（互联网上所处的位置），可见URL是uri的子集
```

## 简单的http协议

```bash
请求报文的组成：请求方法 请求URI 协议版本 可选的请求首部字段 内容实体
响应报文的组成： 协议版本 状态码 用以解释状态的原因短语 可选的响应首部字段 实体主体
```

## http是不保存状态的协议

```bash
使用cookie配合http就可以管理状态了
```

## 请求URI定位资源

http协议使用URI定位互联网上的资源、正是因为URI的特定功能，在互联网上任意位置的资源都能访问到

## 告知服务器意图的http方法

```bash
1 get： 用来请求访问已被URI识别的资源
2 post: 用来传输实体的主体
3 put: 传输文件
4 head : 获得报文首部，用来确认URI的有效性及资源更新的日期时间，和get一样，但是不返回报文主体
5 delete: 删除文件
6 options :询问支持的方法，用来查询针对请求URI指定的资源支持的方法
7 trace ：追踪路径，让web服务器端将之前的请求通信环回给客户端的方法，客户端可以查询发送出去的请求是怎样被加工修改的，该方法容易引起跨站追踪
8 connect :要求用隧道协议连接代理
```

## 持久连接

```bash
持久连接旨在建立一次TCP连接后进行多次请求和响应的交互
好处： 减少了TCP连接的重复建立和断开造成的额外开销，减轻了服务器的负载
```

## 管线化

```bash
持久连接使得多数请求以管线化方式发送成为可能，可以并行发送多个请求
```

## 使用cookie的状态管理

```bash
cookie会根据从服务器端发送的响应报文内的一个叫做set-Cookie的首部字段信息，通知客户端保存Cookie。当客户端再次往该服务器发送请求时，客户端会自动在请求报文中加入cookie值后再发送出去
服务端发现客户端发送过来的cookie,会检查是哪个客户端发送来的连接请求，然后对比服务器的纪录，最后得到之前的状态信息
```

## http报文中的http信息

```bash
请求报文及响应报文的结构
报文是由报文首部和报文主体构成的
对于请求报文来说，他的报文首部包括请求行 请求首部字段 通用首部字段 实体首部字段 和其他组成
对于响应报文来说，他的报文首部包括状态行 响应首部字段 通用首部字段 实体首部字段 和其他组成
# 名词解释
请求行：包括了请求方法，请求URI和http版本
状态行： 包括响应结果的状态码，原因短语和http版本
首部字段：包含请求和响应的各种条件和属性的各类首部，一般有通用首部，请求首部，响应首部和实体首部
其他： 可能包含http中ref里未定义的首部
```

## 分割发送的分块传输编码

```bash
分块传输编码会将实体主体分成多个部分，每一块用十六进制来标记块的大小，在实体主体的最后一块使用"0"来标记
使用分块传输编码的实体主体会由接受的客户端负责解码，恢复到编码之前的实体主体
```

## 发送多种数据的多部分对象集合

## 内容协商

```bash
内容协商会以响应资源的语言，字符集，编码方式等作为判断的基准、
比如：返回同一个网站，他是应该返回中文版的还是英文版的
内容协商的3种类型：
服务器驱动协商
客户端驱动协商
透明协商
```

## 返回结果的http状态码

```bash
2开头：
   200 ok
   204 请求处理成功，但是没有资源返回
   206 客户端进行了范围请求
3开头（浏览器需要执行某些特殊处理以正确处理请求）：
   301 ：永久性重定向
   302； 临时重定向
   303: 客户端应当采用get方法获取资源
   304：客户端发送附带条件的请求时，服务器端允许请求访问地址，但是未满足条件的情况
   307:临时重定向
 4开头：
   400: 请求报文中存在语法错误
   401:未通过认证
   403: 客户端的访问被服务器拒绝
   404:服务器上无法找到请求的资源
  5开头：
  500:服务器内部发生错误
  503:服务器处于超负载或者正在进行停机维护

```

## 与http协作的web服务器

```bash
在物理层面只有一台服务器，但是只要使用虚拟主机的功能，就可以假想已具有多台服务器
```

## 通信数据转发程序：代理，网关，隧道

```bash
代理：具有转发功能的应用程序,不会改变请求URI，会直接发送给前方持有资源的目标服务器
	每次通过代理服务器转发或响应时，会追加写入via首部信息
	代理的犯法； 缓存代理和透明代理
网关：转发其他服务器通信数据的服务器
隧道： 在相隔甚远的客户端和服务器之间进行中转，目的是保证客户端和服务器的安全通信
```

## 保存资源的缓存

```bash
缓存是代理服务器或客户端本地磁盘内保存的资源副本，利用缓存可以减少对源服务器的访问
缓存是有有效期的
缓存不仅存在于服务器，还存在于客户端的浏览器，在客户端，缓存被称之为临时网络文件
```

## http首部

```bash
1 http 请求报文
  组成： 方法 URI http版本 http首部字段
2 http响应报文
  组成： http版本 状态码 http首部字段
```

## http首部字段

```bash
1 http首部字段传递重要信息
  是构成http报文的要素之一
2 http首部字段结构
  组成： 字段名和字段值，中间用冒号分割
3 4种http首部字段类型
	通用首部字段
	请求首部字段
	响应首部字段
	实体首部字段
```

通用首部字段

```bash
cache-control     控制缓存的行为
connection        逐跳首部连接的管理
Date              创建报文的日期时间
pragma            报文指令
Trailer。         报文末端的首部一览
Transfer-Encoding 指定报文主体的传输编码方式
Upgrade           升级为其他协议
Via。             代理服务器的相关信息
Warning           错误通知
```

请求首部字段

```bash
Accept    用户代理可处理的媒体类型
Accept-Charset   优先的字符集
Accept-Encoding    优先的内容编码
Accept-Language    优先的语言（自然语言）
Authorization.     web认证信息
Expect            期待服务器的特定行为
From             用户的电子邮箱地址
Host            请求资源所在服务器
If-Match        比较实体标记
If-Modified-Since。比较资源的更新时间
If-None-Match     比较实体标记
If-Range。        资源未更新时发送实体byte的范围请求
If-Unmodified-Since。比较资源的更新时间
Max-Forwords   最大的传输逐跳数
Proxy-Authoriztion   代理服务器要求客户端的认证信息
Range    实体的字节范围请求
Referer  对请求的URI的原始获取方
TE    传输编码的优先级
User-Agent    Http客户端程序的信息
```

响应首部字段

```bash
Accept-Range     是否接受字段范围请求
Age              推算
```



